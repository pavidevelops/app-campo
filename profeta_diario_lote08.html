<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Evidente - L08</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: sans-serif; margin:0; padding:0; }
    header { background:#004d40; color:#fff; padding:10px; text-align:center; }
    .wrap { padding:10px; }
    .search-wrap { margin-bottom:10px; }
    .list { display:block; }
    .list button { display:block; width:100%; margin-bottom:6px; padding:10px; font-size:16px; }
    .hidden { display:none; }
    textarea { width:100%; height:60px; margin-top:10px; }
    .actions { margin-top:20px; }
    .actions button { width:100%; padding:12px; font-size:16px; margin-top:6px; }
    #preview { margin-top:20px; text-align:center; }
    #preview img { max-width:100%; border:1px solid #ccc; }
    #status { margin-top:10px; }
    .toast { position:fixed; bottom:20px; left:50%; transform:translateX(-50%); background:#333; color:#fff; padding:10px 20px; border-radius:4px; display:none; }
  </style>
</head>
<body>
  <header>
    <h1>Evidente - L08</h1>
  </header>
  <div class="wrap">
    <div class="search-wrap" id="searchWrap">
      <input type="text" id="search" placeholder="Buscar atividade...">
    </div>
    <div class="list" id="list"></div>

    <textarea id="comment" placeholder="Observações"></textarea>

    <div class="actions">
      <button id="btnCapture">Abrir Câmera</button>
      <button id="btnSend" class="hidden">Enviar</button>
      <button id="btnCancel" class="hidden">Cancelar</button>
    </div>

    <div id="preview" class="hidden"></div>
    <div id="status"></div>
  </div>

  <div id="toast" class="toast"></div>

  <script>
    const atividades = [
      { cod: 'PODA', atividade: 'Poda' },
      { cod: 'ROCADA', atividade: 'Roçada' },
      { cod: 'SARJETA', atividade: 'Sarjeta' },
      { cod: 'INSPECAO', atividade: 'Inspeção' }
    ];

    const els = {
      searchWrap: document.getElementById('searchWrap'),
      search: document.getElementById('search'),
      list: document.getElementById('list'),
      comment: document.getElementById('comment'),
      btnCapture: document.getElementById('btnCapture'),
      btnSend: document.getElementById('btnSend'),
      btnCancel: document.getElementById('btnCancel'),
      preview: document.getElementById('preview'),
      status: document.getElementById('status'),
      toast: document.getElementById('toast')
    };

    let currentActivity = null;
    let currentPhoto = null;

    function renderList(items){
      els.list.innerHTML = '';
      items.forEach(a=>{
        const b = document.createElement('button');
        b.textContent = a.atividade;
        b.onclick = ()=> selectActivity(a);
        els.list.appendChild(b);
      });
    }

    function selectActivity(a){
      currentActivity = a;
      els.searchWrap.style.display='none';
      els.list.style.display='none';
      els.btnCapture.classList.remove('hidden');
    }

    function restoreList(){
      // mostra de novo a busca + lista
      els.searchWrap.style.display = '';
      els.list.style.display = '';
      // limpa qualquer termo digitado para não “sumir” itens
      els.search.value = '';
      // re-renderiza todas as opções
      renderList(atividades);
      // sobe a tela pro topo (útil quando saiu do preview/câmera)
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function resetAll(){
      currentActivity = null;
      currentPhoto = null;
      els.preview.classList.add('hidden');
      els.preview.innerHTML='';
      els.btnCapture.classList.add('hidden');
      els.btnSend.classList.add('hidden');
      els.btnCancel.classList.add('hidden');
      els.status.textContent='';
      restoreList();
    }

    function setStatus(msg){
      els.status.textContent = msg;
    }

    function showToast(msg){
      els.toast.textContent = msg;
      els.toast.style.display='block';
      setTimeout(()=>{ els.toast.style.display='none'; },2000);
    }

    async function openCamera(){
      setStatus('Abrindo câmera...');
      // simulação de foto
      currentPhoto = 'https://via.placeholder.com/400x300.png?text=FOTO';
      els.preview.innerHTML = '<img src="'+currentPhoto+'">';
      els.preview.classList.remove('hidden');
      els.btnSend.classList.remove('hidden');
      els.btnCancel.classList.remove('hidden');
      els.btnCapture.classList.add('hidden');
      setStatus('Foto capturada');
    }

    async function send(){
      if(!currentActivity || !currentPhoto){
        showToast('Atividade ou foto ausente');
        return;
      }
      setStatus('Enviando...');
      await new Promise(r=>setTimeout(r,1000));
      setStatus('✅ Enviado com sucesso!');
      showToast('Registro enviado');
      resetAll();
      window.scrollTo({top:0, behavior:'smooth'});
    }

    function init(){
      renderList(atividades);
      els.search.value = '';   // limpa o campo logo no início
      els.search.addEventListener('input', function(){
        const t = els.search.value.toLowerCase();
        const filtered = atividades.filter(a =>
          a.cod.toLowerCase().includes(t) ||
          a.atividade.toLowerCase().includes(t)
        );
        renderList(filtered);
      });

      els.comment.addEventListener('focus', function(){
        setTimeout(()=>{ window.scrollTo({top:els.comment.offsetTop-120, behavior:'smooth'}); },250);
      });

      els.btnCapture.onclick = openCamera;
      els.btnSend.onclick = send;
      els.btnCancel.onclick = resetAll;
    }

    init();
  </script>
</body>
</html>
